# Travis CI configuration for libseccomp

# https://docs.travis-ci.com/user/trusty-ci-environment
# https://wiki.ubuntu.com/Releases

dist: trusty
sudo: false

notifications:
  email:
    on_success: always
    on_failure: always

language: c
compiler:
  - gcc

addons:
  apt:
    packages:
      - build-essential
      - python
      - python-dev
      - python-pip
      - valgrind
      - clang

# resolve any remaining dependency issues
before_install:
  # ubuntu 14.04 (trusty) has an old version of cython
  - pip install cython

# perform the build and fail immediately on error
install:
  - ./autogen.sh
  - ./configure --enable-python
  - make check-build

# run all of the tests independently, fail if any of the tests error
script:
  - (cd src; make check)
  - (cd tests; make check)
  - (cd tests; ./regression -T live)
  # ubuntu 14.04 (trusty) clang has problems with the cython generated code
  - make clean && ./configure && scan-build make
